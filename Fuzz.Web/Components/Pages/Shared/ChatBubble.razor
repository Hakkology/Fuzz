@using Fuzz.Web.Utilities
@using MudBlazor

<div class="chat-bubble-wrapper @(IsUser ? "user" : "agent")">
    @if (!IsUser)
    {
        <MudAvatar Color="@AvatarColor" Size="Size.Small" Class="chat-avatar">
            <MudIcon Icon="@AvatarIcon" Size="Size.Small" />
        </MudAvatar>
    }
    
    <div class="chat-bubble @(IsUser ? "user-bubble" : "agent-bubble")">
        <div class="chat-content">@((MarkupString)MarkdownHelper.ToHtml(Message))</div>
        <span class="chat-time">@Timestamp.ToString("HH:mm")</span>
    </div>

    @if (IsUser)
    {
        <MudAvatar Color="Color.Secondary" Size="Size.Small" Class="chat-avatar">
            <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small" />
        </MudAvatar>
    }
</div>

<style>
    .chat-bubble-wrapper {
        display: flex;
        align-items: flex-end;
        gap: 8px;
    }
    
    .chat-bubble-wrapper.user {
        flex-direction: row;
        justify-content: flex-end;
    }
    
    .chat-bubble-wrapper.agent {
        flex-direction: row;
        justify-content: flex-start;
    }
    
    .chat-avatar {
        flex-shrink: 0;
    }
    
    .chat-bubble {
        max-width: 75%;
        padding: 12px 16px;
        border-radius: 16px;
        position: relative;
    }
    
    .user-bubble {
        background: linear-gradient(135deg, #FF6B35, #FF8F5E);
        color: white;
        border-bottom-right-radius: 4px;
    }
    
    .agent-bubble {
        background: rgba(40, 40, 60, 0.9);
        color: #E0E0E0;
        border-bottom-left-radius: 4px;
        border: 1px solid rgba(255, 107, 53, 0.2);
    }
    
    .chat-content {
        line-height: 1.5;
        white-space: pre-wrap;
        word-break: break-word;
    }
    
    .chat-time {
        display: block;
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 4px;
        text-align: right;
    }
</style>

@code {
    [Parameter] public string Message { get; set; } = "";
    [Parameter] public bool IsUser { get; set; }
    [Parameter] public DateTime Timestamp { get; set; }
    [Parameter] public Color AvatarColor { get; set; } = Color.Primary;
    [Parameter] public string AvatarIcon { get; set; } = Icons.Material.Filled.SmartToy;
}
