@implements IDisposable
@inject NavigationManager NavigationManager

<MudNavMenu Color="Color.Primary" Bordered="false" Dense="false" Class="mt-2">
    <MudText Typo="Typo.overline" Class="px-4 py-2" Style="color: rgba(255, 107, 53, 0.7);">
        MAIN MENU
    </MudText>
    
    <MudNavLink Href="" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">
        Home
    </MudNavLink>
    
    <MudNavLink Href="/agent-chat" Icon="@Icons.Material.Filled.Chat">
        Talk Chat
    </MudNavLink>

    <MudNavLink Href="/agent-todo" Icon="@Icons.Material.Filled.TaskAlt">
        Todo Chat
    </MudNavLink>
    
    <MudNavLink Href="/agent-visual" Icon="@Icons.Material.Filled.ImageSearch">
        Visual Chat
    </MudNavLink>

    <MudNavLink Href="/agent-sound" Icon="@Icons.Material.Filled.MusicNote">
        Sound Chat
    </MudNavLink>

    <MudNavLink Href="/agent-sql-chat" Icon="@Icons.Material.Filled.Terminal">
        SQL Chat
    </MudNavLink>

    <MudDivider Class="my-3" />
    
    <MudText Typo="Typo.overline" Class="px-4 py-2" Style="color: rgba(255, 107, 53, 0.7);">
        ACCOUNT
    </MudText>
    
    <AuthorizeView>
        <Authorized>
            <MudNavLink Href="/Settings" Icon="@Icons.Material.Filled.Settings">
                AI Settings
            </MudNavLink>
            <AuthorizeView Roles="Admin" Context="AdminContext">
                <MudNavLink Href="/Admin/Models" Icon="@Icons.Material.Filled.AdminPanelSettings">
                    Model Management
                </MudNavLink>
            </AuthorizeView>
            <MudNavLink Href="/Account/Manage" Icon="@Icons.Material.Filled.ManageAccounts">
                Profile Settings
            </MudNavLink>
        </Authorized>
        <NotAuthorized>
            <MudNavLink Href="/Account/Register" Icon="@Icons.Material.Filled.PersonAdd">
                Register
            </MudNavLink>
            <MudNavLink Href="/Account/Login" Icon="@Icons.Material.Filled.Login">
                Login
            </MudNavLink>
        </NotAuthorized>
    </AuthorizeView>
</MudNavMenu>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}
